name: Card Check

on:
  workflow_dispatch: # permite rodar manualmente
  schedule:
    - cron: "*/30 * * * *" # a cada 30 minutos

jobs:
  check-cards:
    runs-on: ubuntu-latest
    env:
      BEARER_TOKEN: ${{ secrets.BEARER_TOKEN }}
      PUSHOVER_USER_KEY: ${{ secrets.PUSHOVER_USER_KEY }}
      PUSHOVER_API_TOKEN: ${{ secrets.PUSHOVER_API_TOKEN }}

    steps:
      - name: ğŸ“¦ Checkout do repositÃ³rio
        uses: actions/checkout@v4

      # ğŸ§± Cache do node_modules (para nÃ£o reinstalar toda vez)
      - name: âš¡ Restaurar cache do npm
        uses: actions/cache@v4
        with:
          path: ~/.npm
          key: npm-cache-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            npm-cache-

      - name: ğŸ§° Instalar dependÃªncias
        run: |
          npm install node-fetch@2

      - name: ğŸ’¾ Restaurar Ãºltimo resultado (cache)
        uses: actions/cache@v4
        with:
          path: last_results.json
          key: card-check-cache

      - name: ğŸ” Rodar verificaÃ§Ã£o de preÃ§os
        run: node check.js

      - name: ğŸ’¾ Salvar novo resultado (cache atualizado)
        uses: actions/cache/save@v4
        with:
          path: last_results.json
          key: card-check-cache
